<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
   		<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
			   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
			   crossorigin=""></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script type="application/javascript" src="https://cdn.jsdelivr.net/npm/vue"></script>
		<script type="application/javascript">
			var app;

			function Init() {
			    app = new Vue({
			        el: "#app",
			        data: 
			        	{
			        		crimes: {},
			        		codes: {},
			        		neighborhoods: {}    	
							
			        	}
			    });
			 	$.ajax('http://localhost:8000/incidents?start_date=2019-10-01&end_date=2019-10-31', {
				  success: (data) => {
				  	//console.log(data);
				  	/*for(i in Object.keys(data))
				  	{
				  		app.crimes[Object.keys(data)[i]] = data[Object.keys(data)[i]];
				  	}*/
				  	app.crimes = data;

				  	/*
				  	I19244992: Object
					block: (...)
					code: (...)
					date: (...)
					incident: (...)
					neighborhood_number: (...)
					police_grid: (...)
					time: (...)
					*/
					console.log(app.crimes);

				  },
				  error: (err) => { console.log(err) }
				});

				$.ajax('http://localhost:8000/neighborhoods', {
				  success: (data) => {
				  	console.log(data);
				  	/*for(i in Object.keys(data))
				  	{
				  		app.crimes[Object.keys(data)[i]] = data[Object.keys(data)[i]];
				  	}*/
				  	app.neighborhoods = data;

				  	/*
				  	I19244992: Object
					block: (...)
					code: (...)
					date: (...)
					incident: (...)
					neighborhood_number: (...)
					police_grid: (...)
					time: (...)
					*/
					//console.log(app.crimes);

				  },
				  error: (err) => { console.log(err) }
				});

				$.ajax('http://localhost:8000/codes', {
				  success: (data) => {
				  	console.log(data);
				  	/*for(i in Object.keys(data))
				  	{
				  		app.crimes[Object.keys(data)[i]] = data[Object.keys(data)[i]];
				  	}*/
				  	app.codes = data;

				  	/*
				  	I19244992: Object
					block: (...)
					code: (...)
					date: (...)
					incident: (...)
					neighborhood_number: (...)
					police_grid: (...)
					time: (...)
					*/
					//console.log(app.crimes);

				  },
				  error: (err) => { console.log(err) }
				});
			}
		</script>
	</head>
	<body onload="Init()">
			<div id="mapid" style = "height: 500px; width: auto"></div>
			<script>
				var mymap = L.map('mapid').setView([44.9537, -93.0900], 11);
				var northWest = L.latLng(44.991548, -93.207680),
			    southEast = L.latLng(44.889845, -93.002029),
			    bounds = L.latLngBounds(southEast, northWest);

			    var popup = L.popup()
			    .setLatLng([51.5, -0.09])
			    .setContent("I am a standalone popup.")
			    .openOn(mymap);

				L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
					maxZoom: 18,
					minZoom: 11,
					attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
						'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
						'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
					id: 'mapbox/streets-v11'
				}).addTo(mymap);

				L.marker([44.949581, -93.186362]).addTo(mymap);
				
				mymap.setMaxBounds(bounds);
				
				

				function onMapClick(e) {
					popup
						.setLatLng(e.latlng)
						.setContent("You clicked the map at " + e.latlng.toString())
						.openOn(mymap);
				}

				mymap.on('click', onMapClick);
			</script>
			<form action="/action_page.php">
			  Latitude: <input type="text" name="fname"><br>
			  Longitude: <input type="text" name="lname"><br>
			  Neighborhood: <input type="text" name="lname"><br>
			  <input type="submit" value="Submit">
			</form>
			<div id="app">
				<div class="scroll_table">
		            <table style = "max-height: 23.5rem;
		    						max-width: 940px;
		    						display: inline-block;
		    						overflow: scroll;
		    						border: solid 1px black;">
		                <thead>
		                    <tr>
		                        <th>Case</th>
		                        <th>Date</th>
		                        <th>Time</th>
		                        <th>Incident</th>
		                        <th>Grid</th>
		                        <th>Neighborhood</th>
		                        <th>Block</th>
		                    </tr>
		                </thead>
		                <tbody>
		                	<tr v-for="(i,k) in crimes">
		                		<td>{{ k }}</td>
				        		<td>{{ i.date }}</td>
				        		<td>{{ i.time }}</td>
				        		<td>{{ i.incident }}</td>
				        		<td>{{ i.police_grid }}</td>
				        		<td>{{ app.neighborhoods['N'+i.neighborhood_number] }}</td>
				        		<td>{{ i.block }}</td>
		                	</tr>
		                </tbody>
		            </table>
		        </div>
	    	</div>
	</body>
</html>