<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
		<link rel="stylesheet" href="style.css"/>
   		<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
			   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
			   crossorigin=""></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script type="application/javascript" src="https://cdn.jsdelivr.net/npm/vue"></script>
		<div id="mapid" style = "height: 500px; width: auto"></div>
		<script type="application/javascript" src="createmap.js"></script>
		<script type="application/javascript">
			var app;

			function Init() {
			    app = new Vue({
			        el: "#app",
			        data: 
			        	{
			        		crimes: {

			        		},
			        		//codes: {},
			        		neighborhoods: {
			        			N1: {name: "Conway/Battlecreek/Highwood", count: 0, latlon: [44.949583, -93.018998]},
								N2: {name: "Greater East Side", count: 0, latlon: [44.977413, -93.025327]},
								N3: {name: "West Side", count: 0, latlon: [44.933553, -93.083709]},
								N4: {name: "Dayton's Bluff", count: 0, latlon: [44.956374, -93.060962]},
								N5: {name: "Payne/Phalen", count: 0, latlon: [44.978519, -93.066275]},
								N6: {name: "North End", count: 0, latlon: [44.976919, -93.112771]},
								N7: {name: "Thomas/Dale(Frogtown)", count: 0, latlon: [44.960916, -93.123018]},
								N8: {name: "Summit/University", count: 0, latlon: [44.948429, -93.130479]},
								N9: {name: "West Seventh", count: 0, latlon: [44.930033, -93.123172]},
								N10: {name: "Como", count: 0, latlon: [44.982312, -93.149042]},
								N11: {name: "Hamline/Midway", count: 0, latlon: [44.962993, -93.162742]},
								N12: {name: "St. Anthony", count: 0, latlon: [44.972917, -93.197787]},
								N13: {name: "Union Park", count: 0, latlon: [44.949893, -93.176716]},
								N14: {name: "Macalester-Groveland", count: 0, latlon: [44.934119, -93.175105]},
								N15: {name: "Highland", count: 0, latlon: [44.910549, -93.173354]},
								N16: {name: "Summit Hill", count: 0, latlon: [44.937188, -93.136739]},
								N17: {name: "Capitol River", count: 0, latlon: [44.947789, -93.100049]}
			        		},
			        		'view_latlon': [45,45],
			        		'view_address': "",
			        		checkedCases: [],
			        		bounds: [(44.991548, -93.207680), (44.889845, -93.002029)],
			        		filters: {incident_type: [], neighborhood_name: [], start_date: '', end_date: '', start_time: '', end_time: ''},
			        		violent_crimes: ['Rape', 'Proactive Police Visit' ,'Murder, Non Negligent Manslaughter', 'Murder, Manslaughter By Negligence', 'Rape, By Force', 'Rape, Attempt', 'Robbery', 'Robbery, Highway, Firearm', 'Robbery, Highway, Knife or Cutting Instrument', 'Robbery, Highway, Other Dangerous Weapons', 'Robbery, Highway, By Strong Arm', 'Robbery, Commercial House, Firearm', 'Robbery, Commercial House, Knife or Cutting Instrument', 'Robbery, Commercial House, Other Dangerous Weapons', 'Robbery, Commercial House, By Strong Arm', 'Robbery, Service Station, Firearm', 'Robbery, Service Station, Other Dangerous Weapons', 'Robbery, Service Station, By Strong Arm', 'Robbery, Convenience Store, Firearm', 'Robbery, Convenience Store, Knife or Cutting Instrument', 'Robbery, Convenience Store, Other Dangerous Weapons', 'Robbery, Convenience Store, By Strong Arm', 'Robbery, Residence, Firearm', 'Robbery, Residence, Knife or Cutting Instrument', 'Robbery, Residence, Other Dangerous Weapons', 'Robbery, Residence, By Strong Arm', 'Robbery, Bank, Firearm', 'Robbery, Bank, Other Dangerous Weapons' ,'Robbery, Bank, By Strong Arm', 'Robbery, Misc., Firearm', 'Aggravated Assault', 'Aggravated Assault, Firearm', 'Aggravated Assault, Domestic', 'Aggravated Assault, Knife or Cutting Instrument', 'Aggravated Assault, Other Dangerous Weapons', 'Aggravated Assault, Fists/Feet/Hands', 'Burglary, Forced Entry, Night, Residence', 'Burglary, Forced Entry, Night, Residence, Occupied', 'Burglary' , 'Burglary, Forced Entry, Night, Commercial, Occupied', 'Burglary, No Forced Entry, Night, Residence', 'Burglary, No Forced Entry, Night, Residence', 'Burglary, No Forced Entry, Night, Garage', 'Burglary, No Forced Entry, Night, Commercial', 'Att. Burglary, Forced Entry, Night, Residence', 'Att. Burglary, Forced Entry, Night, Residence, Occupied', 'Att. Burglary, Forced Entry, Night, Garage', 'Att. Burglary, Forced Entry, Night, Commercial' , 'Att. Burglary, Forced Entry, Night, Commercial, Occupied', 'Att. Burglary, Forced Entry, Day, Residence', 'Att. Burglary, Forced Entry, Day, Residence, Occupied', 'Att. Burglary, Forced Entry, Day, Garage', 'Att. Burglary, Forced Entry, Day, Commercial', 'Theft, Except Auto Theft', 'Theft - Mail/Package', 'Theft, Pocket Picking, Under $500', 'Theft, Pocket Picking, $501 to $1000', 'Theft, Pocket Picking, Over $1000', 'Theft - Mail/Package', 'Theft, Purse Snatching, Under $500', 'Theft, Purse Snatching, $501 to $1000', 'Theft, Purse Snatching, Over $1000', 'Theft, Shoplifting', 'Theft, Shoplifting, Under $500', 'Theft, Shoplifting, $501 to $1000', 'Theft, Shoplifting, Over $1000', 'Theft, From Auto', 'Theft, From Auto, Under $500', 'Theft, From Auto, $501 to $1000', 'Theft, From Auto, Over $1000', 'Theft, Auto Accessories, Under $500', 'Theft, Auto Accessories, $501 to $1000', 'Theft, Auto Accessories, Over $1000', 'Theft, Bicycle Theft, Under $500', 'Theft, Bicycle Theft, $501 to $1000', 'Theft, Bicycle Theft, Over $1000', 'Theft, From Building, Under $500', 'Theft, From Building, $501 to $1000', 'Theft, From Building, Over $1000', 'Theft, From Coin Operated Device, Under $500', 'Theft, From Coin Operated Device, $501 to $1000', 'Theft, From Coin Operated Device, Over $1000', 'Theft, All Other, Under $500', 'Theft, All Other, $501 to $1000', 'Theft, All Other, Over $1000', 'Motor Vehicle Theft', 'Motor Vehicle Theft, Automobile', 'Motor Vehicle Theft, Trucks and Buses', 'Motor Vehicle Theft, All Other Vehicles', 'Att. Motor Vehicle Theft, Automobile', 'Att. Motor Vehicle Theft, Trucks and Buses', 'Att. Motor Vehicle Theft, All Other Vehicles', 'Assault, Domestic, Opposite Sex', 'Assault, Domestic, Family/Child', 'Assault, Domestic, Gross Misdemeanor', 'Arson', 'Arson, Residential, Single Occupancy, Endangering Life', 'Arson, Residential, Single Occupancy, Other', 'Arson, Residential, Single, Abandoned, Other', 'Arson, Residential, Multiple Occupancy, Endangering Life', 'Arson, Residential, Multiple Occupancy, Other', 'Arson, Residential, Multiple, Abandoned, Other', 'Arson, Commercial, Indust/Manu, Endangering Life', 'Arson, Commercial, Indust/Manu, Other', 'Arson, Other Commercial, Endangering Life', 'Arson, Other Commercial, Other', 'Arson, Community Building, Endangering Life', 'Arson, Community Building, Other', 'Arson, Storage Building', 'Arson, All Other Structures', 'Arson, Motor Vehicle', 'Arson, Motor Vehicle, Abandoned', 'Arson, Not Structure', 'Arson, Not Structure, Abandoned', 'Criminal Damage to Property', 'Graffiti', 'Criminal Damage to Property (Misdemeanor, Under $250)', 'Graffiti (Misdemeanor, Under $250)', 'Graffiti-Gang (Misdemeanor, Under $250)', 'Criminal Damage to Property (Gross Mis., $250-$500)', 'Graffiti (Gross Mis., $250-$500', 'Graffiti-Gang (Gross Mis., $250-$500)', 'Narcotics, Possession of Cocaine', 'Narcotics, Possession of Heroin', 'Narcotics, Possession of Methamphetamine', 'Narcotics, Possession of MDMA (Ecstasy)', 'Narcotics, Possession With Intent to Sell Cocaine', 'Narcotics, Possession of Synthetic Narcotic, Demerol, Etc.', 'Narcotics, Possession With Intent to Sell Heroin', 'Narcotics, Possession With Intent to Sell Methamphetamine', 'Narcotics, Possession With Intent to Sell MDMA (Ecstasy)', 'Narcotics, Possession With Intent to Sell Synthetics', 'Narcotics, Possession of Dangerous Non-Narcotic Drugs', 'Narcotics, Possession of Marijuana', 'Narcotics, Selling Opium, Cocaine, Etc.', 'Narcotics, Selling Cocaine', 'Narcotics, Selling Heroin', 'Narcotics, Selling Methamphetamine', 'Narcotics, Possession With Intent to Sell Non-Narcotics', 'Narcotics, Selling Synthetic Narcotics', 'Narcotics, Possession With Intent to Sell Marijuana', 'Narcotics, Selling Marijuana', 'Narcotics, Possession of Inhalants', 'Narcotics, Possession of Narcotic Paraphernalia', 'Narcotics, Loitering With Intent to Sell Narcotics', 'Weapons, Discharging a Firearm in the City Limits', 'Proactive Police Visit', 'Community Engagement Event' ]  	
							
			        	}
			    });
			 	$.ajax('http://localhost:8000/incidents?start_date=2019-10-01&end_date=2019-10-31&limit=100', {
				  success: (data) => {
				  	app.crimes = data;
				  	/*
				  	I19244992: Object
					block: (...)
					code: (...)
					date: (...)
					incident: (...)
					neighborhood_number: (...)
					police_grid: (...)
					time: (...)
					*/
					
					for(let i=0; i<Object.keys(app.crimes).length; i++)
					{
						let crime = app.crimes[Object.keys(app.crimes)[i]];
						//console.log(crime);
						//console.log(app.neighborhoods['N'+crime.neighborhood_number].count)*/
						app.neighborhoods['N'+crime.neighborhood_number].count = app.neighborhoods['N'+crime.neighborhood_number].count + 1;
					}
					for(let i = 1; i < Object.keys(app.neighborhoods).length + 1; i++)
					{
						L.marker(app.neighborhoods['N'+i].latlon, {icon: new L.divIcon({html: ' '+app.neighborhoods['N'+i].count+'', iconSize: 20, bgPos: [10,10]})}).addTo(mymap);
						/*var popup = L.popup()
						    .setLatLng(app.neighborhoods['N'+i].latlon)
						    .setContent(app.neighborhoods['N'+i].count)
						    .addTo(mymap);*/

						//console.log(app.neighborhoods['N'+i].latlon);
					}

				  },
				  error: (err) => { console.log(err) }
				});

				
				/*L.marker([44.947789, -93.100049]).addTo(mymap); //Capitol River
				L.marker([44.937188, -93.136739]).addTo(mymap); //Summit Hill
				L.marker([44.910549, -93.173354]).addTo(mymap); //Highland
				L.marker([44.934119, -93.175105]).addTo(mymap); //Macalester-Groveland
				L.marker([44.949893, -93.176716]).addTo(mymap); //Union Park
				L.marker([44.972917, -93.197787]).addTo(mymap); //St. Anthony
				L.marker([44.962993, -93.162742]).addTo(mymap); //Hamline/Midway
				L.marker([44.982312, -93.149042]).addTo(mymap); //Como
				L.marker([44.930033, -93.123172]).addTo(mymap); //West Seventh
				L.marker([44.948429, -93.130479]).addTo(mymap); //Summit/University
				L.marker([44.960916, -93.123018]).addTo(mymap); //Thomas/Dale(frogtown)
				L.marker([44.976919, -93.112771]).addTo(mymap); //North end
				L.marker([44.933553, -93.083709]).addTo(mymap); //Westside
				L.marker([44.977413, -93.025327]).addTo(mymap); //Greater East Side				
				L.marker([44.949583, -93.018998]).addTo(mymap); //Conway/battle creek
				L.marker([44.978519, -93.066275]).addTo(mymap); //Payne-Phalen
				L.marker([44.956374, -93.060962]).addTo(mymap);*/
			};

			function SubmitLatLon(event){
				console.log(app.view_latlon);
				lat = app.view_latlon.split(',');
				console.log(lat);
				let coords = L.latLng(lat[0],lat[1]);
				console.log(coords);
				mymap.setView(coords, 16);
			}

			function SubmitAddress(address){
				console.log(app.view_address);
				$.ajax('https://nominatim.openstreetmap.org/search?q='+app.view_address+'+st+paul&format=json&limit=1', {
					success: (data) => {
					  	//console.log(data);
					  	let coords = L.latLng(data[0].lat, data[0].lon);
					  	console.log(data[0].lon);
					  	mymap.setView(coords, 16);


					},
				  	error: (err) => { console.log(err) }
				});
				//L.map('mapid').setView(latlon, 12);
			}

			function clickCase(event){
				

			}

			function filterCrimes(event){
				console.log(app.filters);
				/*
				$.ajax('http://localhost:8000/incidents?start_date=2019-10-01&end_date=2019-10-31&limit=100', {
				  success: (data) => {

				  }, 
				  error: (err) => { console.log(err) }
				});*/


			}
		</script>
	</head>
	<body onload="Init()">
			<a href='about.html'>About</a>
			<div id="app">
			<H1>Search</H1>
			<input type = "text" v-model="view_latlon" :placeholder="view_latlon"/>
			<button type ="button" @click="SubmitLatLon">Send</button>
			<input type = "text" v-model="view_address" placeholder="address"/>
			<button type ="button" @click="SubmitAddress">Send</button>
			<H1>Filters</H1>
			<input type = "text" v-model="filters.incident_type" placeholder="All"/>
			<select v-model="filters.neighborhood_name" placeholder="All">
				<option value="volvo">Volvo</option>
			    <option value="saab">Saab</option>
			    <option value="fiat">Fiat</option>
			    <option value="audi">Audi</option>
			</select>
			<input type = "text" v-model="filters.neighborhood_name" placeholder="All"/>
			<input type = "text" v-model="filters.start_date" placeholder="2019/10/01"/>
			<input type = "text" v-model="filters.end_date" placeholder="2019/10/31"/>
			<input type = "text" v-model="filters.start_time" placeholder="00:00"/>
			<input type = "text" v-model="filters.end_date" placeholder="11:59"/>
			<button type ="button" @click="filterCrimes">Filter</button>
			
				<div class="scroll_table">
		            <table style = "max-height: 23.5rem;
		    						max-width: 940px;
		    						display: inline-block;
		    						overflow: scroll;
		    						border: solid 1px black;">
		                <thead>
		                    <tr>
		                        <th>Case</th>
		                        <th>Date</th>
		                        <th>Time</th>
		                        <th>Incident</th>
		                        <th>Grid</th>
		                        <th>Neighborhood</th>
		                        <th>Block</th>
		                    </tr>
		                </thead>
		                <tbody>
		                	<tr v-for="(i,k) in crimes" v-if="mymap.getBounds().contains(app.neighborhoods['N'+i.neighborhood_number].latlon)" 
		                	v-bind:class="{'violent':(violent_crimes.includes(i.incident))/*'violent':(i.incident == 'Proactive Police Visit')*/}" >
		                		<td>{{ k }}</td>
				        		<td>{{ i.date }}</td>
				        		<td>{{ i.time }}</td>
				        		<td>{{ i.incident }}</td>
				        		<td>{{ i.police_grid }}</td>
				        		<td>{{ /*app.neighborhoods['N'+i.neighborhood_number].name*/ }}</td>
				        		<td>{{ i.block }}</td>
				        		<td>
				        			<input type="checkbox" id='checkbox'>
									<label></label>
								</td>
								<td></td>

		                	</tr>
		                </tbody>
		            </table>
		        </div>
	    	</div>
	</body>
</html>